---
import Base from "../layout/Base.astro";
import AdminDashboard from "../components/AdminDashboard";
import { supabase } from "../lib/supabase";
export const prerender = false;

const { data: { session } } = await supabase.auth.getSession();

if (!session) {
  return Astro.redirect("/");
}

// Fetch orders data from the API
const response = await fetch(`${Astro.url.origin}/api/woo/get-orders`);
const ordersData = await response.json();

// Verificar que ordersData tenga la estructura correcta
if (!ordersData.data?.orders) {
  ordersData.data = {
    orders: [],
    total: "0",
    totalPages: "0"
  };
}

const title = "Test Dashboard";
---

<Base title={title}>
  <div class="container py-6">
    <AdminDashboard 
      client:load
      initialOrders={ordersData.data.orders}
      initialTotal={ordersData.data.total}
      initialTotalPages={ordersData.data.totalPages}
    />
  </div>
</Base>
